"use strict";(self.webpackChunkdistributed_systems=self.webpackChunkdistributed_systems||[]).push([[291],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=p(n),h=r,u=m["".concat(l,".").concat(h)]||m[h]||c[h]||o;return n?a.createElement(u,i(i({ref:t},d),{},{components:n})):a.createElement(u,i({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5187:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const o={},i="Lab 1: Threads",s={unversionedId:"labs/threads/threads",id:"labs/threads/threads",title:"Lab 1: Threads",description:"Table Of Contents",source:"@site/docs/labs/01.threads/threads.md",sourceDirName:"labs/01.threads",slug:"/labs/threads/threads",permalink:"/docs/labs/threads/threads",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Git",permalink:"/docs/labs/git/git"},next:{title:"Student Assignments",permalink:"/docs/students/student-assignments"}},l={},p=[{value:"Table Of Contents",id:"table-of-contents",level:2},{value:"<strong>Exercise 1: Creating Responsive UI</strong>",id:"exercise-1-creating-responsive-ui",level:2},{value:"<strong>Create a Project</strong>",id:"create-a-project",level:3},{value:"<strong>Run the Project</strong>",id:"run-the-project",level:3},{value:"<strong>Exercise 2: Creating Threads</strong>",id:"exercise-2-creating-threads",level:2},{value:"<strong>Create a Project</strong>",id:"create-a-project-1",level:3},{value:"<strong>Run the Project</strong>",id:"run-the-project-1",level:3},{value:"<strong>Exercise 3: Managing Threads</strong>",id:"exercise-3-managing-threads",level:2},{value:"<strong>Create a Project</strong>",id:"create-a-project-2",level:3},{value:"<strong>Run the Project</strong>",id:"run-the-project-2",level:3},{value:"<strong>Exercise 4: Using Pools</strong>",id:"exercise-4-using-pools",level:2},{value:"<strong>Create a Project</strong>",id:"create-a-project-3",level:3},{value:"<strong>Run the Project</strong>",id:"run-the-project-3",level:3},{value:"<strong>Exercise 5: Using Tasks</strong>",id:"exercise-5-using-tasks",level:2},{value:"<strong>Create a Project</strong>",id:"create-a-project-4",level:3},{value:"<strong>Run Project</strong>",id:"run-project",level:3},{value:"<strong>Exercise 6: Provoking Races</strong>",id:"exercise-6-provoking-races",level:2},{value:"<strong>Creating Project</strong>",id:"creating-project",level:3},{value:"<strong>Run Project</strong>",id:"run-project-1",level:3},{value:"<strong>Exercise 7: Using async/await</strong>",id:"exercise-7-using-asyncawait",level:2},{value:"<strong>Create a Project</strong>",id:"create-a-project-5",level:3},{value:"<strong>Run Project</strong>",id:"run-project-2",level:3}],d={toc:p};function c(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"lab-1-threads"},"Lab 1: Threads"),(0,r.kt)("h2",{id:"table-of-contents"},"Table Of Contents"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#lab-1-threads"},"Lab 1: Threads"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#table-of-contents"},"Table Of Contents")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#exercise-1-creating-responsive-ui"},(0,r.kt)("strong",{parentName:"a"},"Exercise 1: Creating Responsive UI")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-project"},(0,r.kt)("strong",{parentName:"a"},"Create a Project"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#run-the-project"},(0,r.kt)("strong",{parentName:"a"},"Run the Project"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#exercise-2-creating-threads"},(0,r.kt)("strong",{parentName:"a"},"Exercise 2: Creating Threads")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-project-1"},(0,r.kt)("strong",{parentName:"a"},"Create a Project"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#run-the-project-1"},(0,r.kt)("strong",{parentName:"a"},"Run the Project"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#exercise-3-managing-threads"},(0,r.kt)("strong",{parentName:"a"},"Exercise 3: Managing Threads")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-project-2"},(0,r.kt)("strong",{parentName:"a"},"Create a Project"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#run-the-project-2"},(0,r.kt)("strong",{parentName:"a"},"Run the Project"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#exercise-4-using-pools"},(0,r.kt)("strong",{parentName:"a"},"Exercise 4: Using Pools")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-project-3"},(0,r.kt)("strong",{parentName:"a"},"Create a Project"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#run-the-project-3"},(0,r.kt)("strong",{parentName:"a"},"Run the Project"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#exercise-5-using-tasks"},(0,r.kt)("strong",{parentName:"a"},"Exercise 5: Using Tasks")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-project-4"},(0,r.kt)("strong",{parentName:"a"},"Create a Project"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#run-project"},(0,r.kt)("strong",{parentName:"a"},"Run Project"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#exercise-6-provoking-races"},(0,r.kt)("strong",{parentName:"a"},"Exercise 6: Provoking Races")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#creating-project"},(0,r.kt)("strong",{parentName:"a"},"Creating Project"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#run-project-1"},(0,r.kt)("strong",{parentName:"a"},"Run Project"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#exercise-7-using-asyncawait"},(0,r.kt)("strong",{parentName:"a"},"Exercise 7: Using async/await")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-project-5"},(0,r.kt)("strong",{parentName:"a"},"Create a Project"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#run-project-2"},(0,r.kt)("strong",{parentName:"a"},"Run Project")))))))),(0,r.kt)("h2",{id:"exercise-1-creating-responsive-ui"},(0,r.kt)("strong",{parentName:"h2"},"Exercise 1: Creating Responsive UI")),(0,r.kt)("p",null,"In this exercise you will improve responsiveness of a WPF GUI application using threads."),(0,r.kt)("p",null,"A thread is a single path of execution within a process."),(0,r.kt)("h3",{id:"create-a-project"},(0,r.kt)("strong",{parentName:"h3"},"Create a Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a C# WPF project, named Threads.ResponsiveUi in solution Threads.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dotnet new sln --name Threads\ndotnet new wpf --name Threads.ResponsiveUi\ndotnet sln add Threads.ResponsiveUi/Threads.ResponsiveUi.csproj\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Add the following code to class ",(0,r.kt)("inlineCode",{parentName:"li"},"MainWindow.xaml"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<Window x:Class="Threads.ResponsiveUi.MainWindow"\n        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\n        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\n        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\n        mc:Ignorable="d"\n        Title="MainWindow" Height="450" Width="800">\n    <Canvas>\n        <Button Canvas.Left="50" Canvas.Top="60" Content="Submit" Click="ButtonClick" />\n        <Button Canvas.Left="50" Canvas.Top="85" Content="Submit Responsive" Click="ResponsiveButtonClick" />\n    </Canvas>\n</Window>\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Add the following code to class ",(0,r.kt)("inlineCode",{parentName:"li"},"MainWindow.xaml.cs"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'using System;\nusing System.Diagnostics;\nusing System.Threading;\nusing System.Windows;\n\nnamespace Threads.ResponsiveUi\n{\n    /// <summary>\n    /// Interaction logic for MainWindow.xaml\n    /// </summary>\n    public partial class MainWindow : Window\n    {\n        public MainWindow()\n        {\n            InitializeComponent();\n            PrintThreadingInfoToConsole();\n        }\n\n        private static void LengthyOperation()\n        {\n            int tid = Environment.CurrentManagedThreadId;\n\n            Debug.WriteLine($"Thread {tid} is working ... ");\n\n            Thread.Sleep(7000);\n\n            Debug.WriteLine($"Thread {tid} has finished. ");\n        }\n\n        private static void PrintThreadingInfoToConsole()\n        {\n            var nop = Environment.ProcessorCount;\n            Debug.WriteLine($"Your system runs {nop} processors. ");\n\n            var tid = Environment.CurrentManagedThreadId;\n            Debug.WriteLine($"Thread {tid} is running ... ");\n        }\n\n        private void ButtonClick(object sender, RoutedEventArgs e)\n        {\n            LengthyOperation();\n        }\n\n        private void ResponsiveButtonClick(object sender, RoutedEventArgs e)\n        {\n            new Thread(LengthyOperation).Start();\n        }\n    }\n}\n\n')),(0,r.kt)("h3",{id:"run-the-project"},(0,r.kt)("strong",{parentName:"h3"},"Run the Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Execute the project and the output similar to the following will appear:")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"responsive-gui-app",src:n(9975).Z,width:"1165",height:"312"})),(0,r.kt)("h2",{id:"exercise-2-creating-threads"},(0,r.kt)("strong",{parentName:"h2"},"Exercise 2: Creating Threads")),(0,r.kt)("p",null,"In this exercise you will create ",(0,r.kt)("strong",{parentName:"p"},"threads")," that will execute both static and instance methods in threads via delegates."),(0,r.kt)("p",null,"Threads are implemented in the kernel and *Windows switches ",(0,r.kt)("strong",{parentName:"p"},"threads not processes*"),".  "),(0,r.kt)("p",null,"Every thread has:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The kernel object: "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"It stores information about the thread that is used to perform the context switch. For instance, it contains a copy of the CPU registers."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The thread environment block (TEB)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"It stores information such as thread exception handling chain and thread local-storage."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The user and kernel stacks"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"They store stack frames for executing user and kernel code. The user stack is typically 1M and the kernel stack is typically 24k."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"DLL notification mechanisms"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Implements mechanisms to inform all DLLs in the process when a thread is created and destroyed. Managed DLLs do not receive these messages. Unmanaged code can disable these messages.")))),(0,r.kt)("p",null,"Assigning threads to processors is called the context switch."),(0,r.kt)("p",null,"In the Windows context switch is performed every 30 ms."),(0,r.kt)("p",null,"To perform the context switch Windows must:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Save the registers of the currently running thread."),(0,r.kt)("li",{parentName:"ul"},"Select one thread from the set of existing threads. If the selected thread is in another process Windows must switch the virtual address space."),(0,r.kt)("li",{parentName:"ul"},"Load the registers of the selected thread."),(0,r.kt)("li",{parentName:"ul"},"Be aware that Windows usually must populate caches with new code and data !!!")),(0,r.kt)("p",null,"Each CLR process initially has only one thread called the primary thread which starts in method Main and finishes when Main finishes its execution."),(0,r.kt)("p",null,"The programmers can:\nCreate new threads explicitly or\nUse threads from the thread pool."),(0,r.kt)("p",null,"To manage explicit threads, programmers use class ",(0,r.kt)("inlineCode",{parentName:"p"},"Thread"),"."),(0,r.kt)("p",null,"Threads are started in methods with predefined signatures."),(0,r.kt)("p",null,"Thread methods receive either no parameters or an object and return void."),(0,r.kt)("p",null,"A thread can be:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"A ",(0,r.kt)("strong",{parentName:"p"},"foreground")," thread"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Threads used to perform tasks that you want to complete. The application is active until all"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"A ",(0,r.kt)("strong",{parentName:"p"},"background")," thread"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The application (foreground threads) do not wait for background threads. When all foreground threads terminate the process will terminate. Background threads are typically used for tasks that depend on foreground threads - e.g. spelling checking is not necessary when the process is terminated.")))),(0,r.kt)("p",null,"The UML of the application you will create is shown below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"creating-threads",src:n(3714).Z,width:"554",height:"299"})),(0,r.kt)("h3",{id:"create-a-project-1"},(0,r.kt)("strong",{parentName:"h3"},"Create a Project")),(0,r.kt)("p",null,"Create a C# Console project, named CreatingThreads in solution Threads."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dotnet new console --name Threads.CreatingThreads\ndotnet sln add Threads.CreatingThreads/Threads.CreatingThreads.csproj\n")),(0,r.kt)("p",null,"Add class ",(0,r.kt)("inlineCode",{parentName:"p"},"ConcurrentCode")," to the project."),(0,r.kt)("p",null,"Thread methods have predefined signatures. Add the following code to class ",(0,r.kt)("inlineCode",{parentName:"p"},"ConcurrentCode"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'using System;\nusing System.Threading;\n\nnamespace Threads.CreatingThreads\n{\n    public class ConcurrentCode\n    {\n        private static int variable = 1;\n        private readonly int field = 2;\n\n        public static void Function()\n        {\n            var name = Thread.CurrentThread.Name;\n\n            Console.WriteLine($"Function: Executing in thread: {name}");\n            Console.WriteLine($"Function variable: {variable++}");\n            Console.WriteLine("Function: Press any key to terminate.");\n            Console.ReadKey();\n        }\n\n        public void Method(object? parameter)\n        {\n            var name = Thread.CurrentThread.Name;\n            Console.WriteLine($"Method: Executing in thread: {name}");\n            Console.WriteLine($"Method parameter: {parameter}");\n            Console.WriteLine($"Method variable: {++variable}");\n            Console.WriteLine($"Method field: {field}");\n            Console.WriteLine("Method: Press any key to terminate.");\n            Console.ReadKey();\n        }\n\n        public static void Method(string str, int num)\n        {\n            var name = Thread.CurrentThread.Name;\n            Console.WriteLine($"Method: Executing in thread: {name}");\n            Console.WriteLine($"Method str: {str}");\n            Console.WriteLine($"Method num: {num}");\n            Console.WriteLine("Method: Press any key to terminate.");\n            Console.ReadKey();\n        }\n    }\n}\n')),(0,r.kt)("p",null,"Add the following code to class ",(0,r.kt)("inlineCode",{parentName:"p"},"Program"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'using System;\nusing System.Threading;\n\nnamespace Threads.CreatingThreads\n{\n    public static class Program\n    {\n\n        private static readonly ThreadStart ts = new(ConcurrentCode.Function);\n        private static readonly ConcurrentCode code = new();\n        private static readonly ParameterizedThreadStart pts = new(code.Method);\n\n\n        static void Main(string[] args)\n        {\n            var firstThread = new Thread(ts);\n            firstThread.Name = "Zlatni konac litnje zore";\n            //firstThread.IsBackground = true;\n            firstThread.Start();\n\n            var secondThread = new Thread(pts);\n            secondThread.Name = "Der goldene Faden des sommerlichen Morgenrotes";\n            secondThread.Priority = ThreadPriority.Highest;\n            // secondThread.IsBackground = true;\n            secondThread.Start(9);\n\n            var i = 3;\n            var thirdThread = new Thread(() => { ConcurrentCode.Method("Iva", i); });\n            // thirdThread.IsBackground = true;\n            i = 7;\n            thirdThread.Start();\n        }\n\n    }\n}\n\n')),(0,r.kt)("h3",{id:"run-the-project-1"},(0,r.kt)("strong",{parentName:"h3"},"Run the Project")),(0,r.kt)("p",null,"Execute the project and the output similar to the following will appear:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"creating-threads-output",src:n(9513).Z,width:"1080",height:"547"})),(0,r.kt)("h2",{id:"exercise-3-managing-threads"},(0,r.kt)("strong",{parentName:"h2"},"Exercise 3: Managing Threads")),(0,r.kt)("p",null,"In this exercise you will manage threads."),(0,r.kt)("p",null,"Threads can generally be in three states: ",(0,r.kt)("strong",{parentName:"p"},"running"),", ",(0,r.kt)("strong",{parentName:"p"},"blocked"),", and ",(0,r.kt)("strong",{parentName:"p"},"ready"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"thread-lifecycle",src:n(5960).Z,width:"479",height:"360"})),(0,r.kt)("p",null,"In this exercise, the following methods from class Thread will be used:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Sleep")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Puts a thread to sleep for a time specified in milliseconds."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"SpinWait")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Causes a thread to wait the number of times defined by the iteration parameter."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Interrupt")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Wakes up a sleeping thread by raising an exception in the target thread's code."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Join")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Waits for threads to terminate the execution.")))),(0,r.kt)("p",null,"Following methods to manage thread state got ",(0,r.kt)("strong",{parentName:"p"},"deprecated")," because they might cause unexpected behavior if executed while thread is in critical session."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Abort"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Terminates a thread by raising 2 exceptions in the target thread\u2019s code. Exception will be throw at the end of the finally block one more time if ResetAbort is not called in the catch block."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ResetAbort")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Prevents itself to be terminated. ")))),(0,r.kt)("p",null,"In this exercise methods above will be avoided by user defined cancellation behavior."),(0,r.kt)("p",null,"The following are the classes you will implement in this example:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"managing-threads-uml",src:n(7431).Z,width:"509",height:"318"})),(0,r.kt)("h3",{id:"create-a-project-2"},(0,r.kt)("strong",{parentName:"h3"},"Create a Project")),(0,r.kt)("p",null,"Create a C# Console project, named ",(0,r.kt)("inlineCode",{parentName:"p"},"Threads.ManagingThreads")," in solution ",(0,r.kt)("inlineCode",{parentName:"p"},"Threads"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dotnet new console --name Threads.ManagingThreads\ndotnet sln add .\\Threads.ManagingThreads\\Threads.ManagingThreads.csproj\n")),(0,r.kt)("p",null,"Add class ",(0,r.kt)("inlineCode",{parentName:"p"},"ConcurrentCode")," to the project."),(0,r.kt)("p",null,"Use the following namespaces:"),(0,r.kt)("p",null,"Implement a Class ",(0,r.kt)("inlineCode",{parentName:"p"},"ConcurrentCode"),", as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'using System;\nusing System.Threading;\n\nnamespace Threads.ManagingThreads\n{\n    public class ConcurrentCode\n    {\n        public volatile bool done = false;\n\n        public void SleepWhileCodeIsNotDone()\n        {\n            var managedThreadId = Environment.CurrentManagedThreadId;\n            while (!done)\n            {\n                Console.WriteLine($"SleepWhileCodeIsNotDone ({managedThreadId}): Sleeping for 2s");\n                Thread.Sleep(2000);\n            }\n\n            Console.WriteLine($"SleepWhileCodeIsNotDone ({managedThreadId}): Finished.");\n        }\n\n        public void SleepWhileCancellationIsNotRequested(CancellationToken cancellationToken)\n        {\n            int managedThreadId = Environment.CurrentManagedThreadId;\n\n            while (!cancellationToken.IsCancellationRequested)\n            {\n                Console.WriteLine($"SleepWhileCancellationIsNotRequested ({managedThreadId}): Sleeping for 1s");\n                Thread.Sleep(1000);\n            }\n\n            Console.WriteLine($"SleepWhileCancellationIsNotRequested ({managedThreadId}): Finished.");\n        }\n\n\n        public void DoSleepForLongTime()\n        {\n            int managedThreadId = Thread.CurrentThread.ManagedThreadId;\n\n            var iterations = 10000000;\n\n            Console.WriteLine($"DoSleepForLongTime ({managedThreadId}): Doing work for {iterations} iterations.");\n\n            Thread.SpinWait(iterations);\n\n            try\n            {\n                Console.WriteLine($"DoSleepForLongTime ({managedThreadId}): Going to sleep for very long time!");\n                Thread.Sleep(Timeout.Infinite);\n            }\n            catch (ThreadInterruptedException e)\n            {\n                Console.WriteLine($"DoSleepForLongTime ({managedThreadId}): Sleep interupted!");\n                Console.WriteLine($"DoSleepForLongTime ({managedThreadId}): Exception: {e.Message}");\n                Console.WriteLine($"DoSleepForLongTime ({managedThreadId}): Finished.");\n            }\n        }\n    }\n}\n')),(0,r.kt)("p",null,"Implement Class Program, as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'using System;\nusing System.Threading;\n\nnamespace Threads.ManagingThreads\n{\n    public static class Program\n    {\n        public static void Main()\n        {\n            int mid = Thread.CurrentThread.ManagedThreadId;\n            Console.WriteLine("Primary Thread ({0}) ", mid);\n\n            var delay = TimeSpan.FromSeconds(10);\n            var cancellationTokeSource = new CancellationTokenSource(delay);\n\n            var code = new ConcurrentCode();\n            var threads = new[]\n            {\n                new Thread(new ThreadStart(code.SleepWhileCodeIsNotDone)),\n                new Thread(() => code.SleepWhileCancellationIsNotRequested(cancellationTokeSource.Token)),\n                new Thread(code.DoSleepForLongTime),\n            };\n\n            for (int i = 0; i < threads.Length; i++)\n                threads[i].Start();\n\n            Thread.Sleep(3000);\n\n            bool alive = threads[2].IsAlive;\n            if (alive)\n            {\n                Console.WriteLine($"Primary: Thread {{0}} is alive.", threads[2].ManagedThreadId);\n            }\n\n            code.done = true;\n            threads[2].Interrupt();\n\n            for (int i = 0; i < threads.Length; i++)\n            {\n                threads[i].Join();\n            }\n\n            Console.ForegroundColor = ConsoleColor.Red;\n            Console.WriteLine("Main: All threads have terminated.");\n\n            Console.ResetColor();\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"run-the-project-2"},(0,r.kt)("strong",{parentName:"h3"},"Run the Project")),(0,r.kt)("p",null,"Execute the project and the output similar to the following will appear:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"managing-threads-output",src:n(8288).Z,width:"1870",height:"733"})),(0,r.kt)("h2",{id:"exercise-4-using-pools"},(0,r.kt)("strong",{parentName:"h2"},"Exercise 4: Using Pools")),(0,r.kt)("p",null,"In this exercise you will use threads from the pool."),(0,r.kt)("p",null,"Creating and destroying threads is an expensive operation.\nEach CLR process has a thread pool that can be reused by the application.\nWhen a pool thread has completed the work it is not destroyed. Instead, it is returned to the pool and stays there in an idle state. "),(0,r.kt)("p",null,"The features of pool threads:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Run with the normal priority"),(0,r.kt)("li",{parentName:"ol"},"Run always as Background"),(0,r.kt)("li",{parentName:"ol"},"Used for short-running tasks"),(0,r.kt)("li",{parentName:"ol"},"Cannot be aborted prematurely using Abort or Interrupt.")),(0,r.kt)("p",null,"If you need a thread with different features than those listed above use dedicated threads (created with class Thread)!"),(0,r.kt)("p",null,"To invoke an operation using a pool thread you can call method\nQueueUserWorkItem from class ThreadPool."),(0,r.kt)("p",null,"If the thread method throws an exception that is unhandled the CLR terminates the process."),(0,r.kt)("h3",{id:"create-a-project-3"},(0,r.kt)("strong",{parentName:"h3"},"Create a Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a C# Console project, named ",(0,r.kt)("inlineCode",{parentName:"li"},"Threads.UsingPools")," in solution ",(0,r.kt)("inlineCode",{parentName:"li"},"Threads"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dotnet new console --name Threads.UsingPools\ndotnet sln add Threads.UsingPools/Threads.UsingPools.csproj\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Add following namespaces to class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"using System;\nusing System.Threading;\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Add following fields to class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"private static readonly Random random = new();\nprivate static readonly AsyncLocal<string> localData = new();\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Implement method ",(0,r.kt)("inlineCode",{parentName:"li"},"DoCompute")," in class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'static void DoCompute(object? state)\n{\n    var managedThreadId = Environment.CurrentManagedThreadId;\n    var name = localData.Value;\n    \n    Console.WriteLine($"Thread {managedThreadId}, State {state}, Name = \\"{name}\\"  ");\n    Thread.Sleep(random.Next(1000, 1500));\n}\n')),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Implement method ",(0,r.kt)("inlineCode",{parentName:"li"},"Main")," in class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public static void Main()\n{\n    localData.Value = "Ana";\n    \n    for (int i = 0; i < 10; i++)\n    {\n        Thread.Sleep(random.Next(1000, 3000));\n        if (i == 5)\n        {\n            ExecutionContext.SuppressFlow();\n        }\n        ThreadPool.QueueUserWorkItem(DoCompute, i);\n    }\n    Console.WriteLine("Press any key");\n    Console.ReadKey();\n}\n')),(0,r.kt)("h3",{id:"run-the-project-3"},(0,r.kt)("strong",{parentName:"h3"},"Run the Project")),(0,r.kt)("p",null,"Execute the project and the output similar to the following will appear:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"using-thread-pools-output",src:n(4934).Z,width:"300",height:"256"})),(0,r.kt)("h2",{id:"exercise-5-using-tasks"},(0,r.kt)("strong",{parentName:"h2"},"Exercise 5: Using Tasks")),(0,r.kt)("p",null,"In this exercise you will spawn threads using class ",(0,r.kt)("strong",{parentName:"p"},"Task"),"."),(0,r.kt)("p",null,"Using a thread from the pool the programmers doesn't know (there is no built-in support) about:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"When a thread has completed the execution"),(0,r.kt)("li",{parentName:"ol"},"What is the return value from the thread")),(0,r.kt)("p",null,"Class ",(0,r.kt)("inlineCode",{parentName:"p"},"Task")," overcomes the previous shortcomings."),(0,r.kt)("p",null,"A Task constructor receives:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"a delegate to the operation to be executed in a thread"),(0,r.kt)("li",{parentName:"ul"},"optionally, a CancellationToken object that is used "),(0,r.kt)("li",{parentName:"ul"},"optionally, creation options")),(0,r.kt)("p",null,"The return value is generic type specified when we construct a ",(0,r.kt)("inlineCode",{parentName:"p"},"Task<T>"),"."),(0,r.kt)("p",null,"To distinguish a completed task from the faulting one an OperationCanceledException can be thrown."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Task"),"'s methods:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Start")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"starts a task "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Run")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"creates and starts a task  "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Wait")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"waits (blocks) for the task to complete. If the operation in the task throws an exception the thread pool raises an exception in the Wait* or Result methods. "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"WaitAny")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"waits for any task in the array to complete"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"WaitAll")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Waits for all tasks in the array to complete"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"WhenAll")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Returns task which is completed when all tasks in the array complete"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Result")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"returns a value from the thread")))),(0,r.kt)("h3",{id:"create-a-project-4"},(0,r.kt)("strong",{parentName:"h3"},"Create a Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a C# Console project, named ",(0,r.kt)("inlineCode",{parentName:"li"},"Threads.UsingTasks")," in solution ",(0,r.kt)("inlineCode",{parentName:"li"},"Threads"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dotnet new console --name Threads.UsingTasks\ndotnet sln add .\\Threads.UsingTasks\\Threads.UsingTasks.csproj\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Use the following namespaces in file ",(0,r.kt)("inlineCode",{parentName:"li"},"Program.cs"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"using System;\nusing System.Threading;\nusing System.Threading.Tasks;\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Add method ",(0,r.kt)("inlineCode",{parentName:"li"},"DoCompute")," to class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'private static int DoCompute(CancellationToken token, int num)\n{\n    var managedThreadId = Thread.CurrentThread.ManagedThreadId;\n    var total = 0;\n    for (int i = 0; i < num; i++)\n    {\n        total += i;\n\n#if (false)\n        if (token.IsCancellationRequested)\n        {\n            break;\n        } \n#else\n        token.ThrowIfCancellationRequested();\n#endif\n\n        Console.WriteLine($"Thread {managedThreadId}, i: {i} total= {total}");\n        Thread.Sleep(100);\n    }\n    return total;\n}\n')),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Implement method ",(0,r.kt)("inlineCode",{parentName:"li"},"Main")," in class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'    public static void Main()\n    {\n        var managedThreadId = Environment.CurrentManagedThreadId;\n        \n        using var cancellationTokenSource = new CancellationTokenSource();\n        cancellationTokenSource.Token.Register(() => Console.WriteLine($"Thread {managedThreadId}: Canceled!"));\n        \n        var task = new Task<int>(() => DoCompute(cancellationTokenSource.Token, 100), cancellationTokenSource.Token);\n        task.Start();\n\n        Thread.Sleep(2000);\n\n        cancellationTokenSource.Cancel();\n\n        try\n        {\n            task.Wait();\n            var result = task.Result;\n            Console.WriteLine($"Thread {managedThreadId} result: {result}");\n        }\n        catch (AggregateException exception)\n        {\n            Console.WriteLine($"Thread {managedThreadId} Exception: {exception.Message} ");\n        }\n    }\n')),(0,r.kt)("h3",{id:"run-project"},(0,r.kt)("strong",{parentName:"h3"},"Run Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Execute the project and the output similar to the following will appear:")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"using-tasks-output",src:n(5170).Z,width:"397",height:"547"})),(0,r.kt)("h2",{id:"exercise-6-provoking-races"},(0,r.kt)("strong",{parentName:"h2"},"Exercise 6: Provoking Races")),(0,r.kt)("p",null,"In this exercise you will create threads that will execute shared code which executions will result in a race condition."),(0,r.kt)("p",null,"Each thread can have an assigned priority which is relative to the process priority."),(0,r.kt)("p",null,"Here is the UML class diagram of the classes you will implement:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"provoking-races-uml",src:n(3041).Z,width:"439",height:"347"})),(0,r.kt)("h3",{id:"creating-project"},(0,r.kt)("strong",{parentName:"h3"},"Creating Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a C# Console project, named ",(0,r.kt)("inlineCode",{parentName:"li"},"Threads.ProvokingRaces")," in solution ",(0,r.kt)("inlineCode",{parentName:"li"},"Threads"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dotnet new console --name Threads.ProvokingRaces\ndotnet sln add Threads.ProvokingRaces/Threads.ProvokingRaces.csproj\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Add following namespaces to class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"using System;\nusing System.Threading.Tasks;\nusing System.Collections.Generic;\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Add fields to class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"private const int IncrementAmount = 10000;\nprivate static int sum = 0;\nprivate static readonly object incrementLock = new();\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Implement Method ",(0,r.kt)("inlineCode",{parentName:"li"},"IncrementSumSynchronously")," in class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'private static void IncrementSumSynchronously()\n{\n    for (var i = 0; i < IncrementAmount; i++)\n    {\n        sum++;\n    }\n    Console.WriteLine($"Sum value: {sum}");\n}\n')),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Implement Method ",(0,r.kt)("inlineCode",{parentName:"li"},"IncrementSumParallel")," in class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'private static void IncrementSumParallel()\n{\n    var allIncrementTasks = new List<Task>();\n    for (var i = 0; i < IncrementAmount; i++)\n    {\n#if(true)\n        var incrementTask = new Task(() => sum++);\n#else\n        var incrementTask = new Task(() =>\n        {\n            lock (incrementLock)\n            {\n                sum++;\n            }\n        });\n#endif\n        incrementTask.Start();\n        allIncrementTasks.Add(incrementTask);\n    }\n\n    var allTasksFinishedTask = Task.WhenAll(allIncrementTasks);\n\n    allTasksFinishedTask.Wait();\n\n    Console.WriteLine($"Sum value: {sum}");\n}\n')),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Implement Method ",(0,r.kt)("inlineCode",{parentName:"li"},"Main")," in class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"public static void Main()\n{\n    IncrementSumSynchronously();\n    sum = 0;\n    IncrementSumParallel();\n}\n")),(0,r.kt)("h3",{id:"run-project-1"},(0,r.kt)("strong",{parentName:"h3"},"Run Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Execute the project and the output similar to the following will appear:")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"provoking-races-output",src:n(9559).Z,width:"381",height:"178"})),(0,r.kt)("h2",{id:"exercise-7-using-asyncawait"},(0,r.kt)("strong",{parentName:"h2"},"Exercise 7: Using async/await")),(0,r.kt)("p",null,"In this exercise you will use async await statements to write asynchronous code ins synchronous matter."),(0,r.kt)("p",null,"The Task asynchronous programming model (TAP) provides an abstraction over asynchronous code.\nYou write code as a sequence of statements, just like always.\nYou can read that code as though each statement completes before the next begins.\nThe compiler performs many transformations because some of those statements may start work and return a Task that represents the ongoing work."),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"await")," keyword provides a non-blocking way to start a task, then continue execution when that task completes\nMethods which should be started in non-blocking way always must have ",(0,r.kt)("strong",{parentName:"p"},"async")," modifier in its signature.\nThat signals to the compiler that this method contains an ",(0,r.kt)("strong",{parentName:"p"},"await")," statement; it contains asynchronous operations."),(0,r.kt)("h3",{id:"create-a-project-5"},(0,r.kt)("strong",{parentName:"h3"},"Create a Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a C# Console project, named ",(0,r.kt)("inlineCode",{parentName:"li"},"Threads.AsyncAwait")," in solution ",(0,r.kt)("inlineCode",{parentName:"li"},"Threads"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dotnet new console --name Threads.AsyncAwait\ndotnet sln add Threads.AsyncAwait/Threads.AsyncAwait.csproj\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Add following namespaces to class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"using System;\nusing System.Collections.Generic;\nusing System.Diagnostics;\nusing System.Threading.Tasks;\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Add following fields to class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"private const int NumberOfIterations = 100;\nprivate static readonly Stopwatch stopwatch = new();\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Implement method ",(0,r.kt)("inlineCode",{parentName:"li"},"Work")," in class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program")," to do blocking call for 100 milliseconds:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'private static void Work(int iterationNumber)\n{\n    var managedThreadId = Environment.CurrentManagedThreadId;\n    \n    Console.WriteLine($"Thread {managedThreadId} starting work on iteration number {iterationNumber}.");\n    Task.Delay(100).Wait();\n    Console.WriteLine($"Thread {managedThreadId} finished working.");\n}\n')),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Implement method ",(0,r.kt)("inlineCode",{parentName:"p"},"DoWorkSynchronously")," in class ",(0,r.kt)("inlineCode",{parentName:"p"},"Program")," to do call synchronously method ",(0,r.kt)("inlineCode",{parentName:"p"},"Work")," for ",(0,r.kt)("inlineCode",{parentName:"p"},"NumberOfIterations")," times:")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Implement method ",(0,r.kt)("inlineCode",{parentName:"p"},"DoWorkAsynchronously")," in class ",(0,r.kt)("inlineCode",{parentName:"p"},"Program"),":"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"private static async Task DoWorkAsynchronously()\n{\n    var tasks = new List<Task>();\n    for (var i = 0; i < NumberOfIterations; i++)\n    {\n        var iterationNumber = i;\n        var task = new Task(() => Work(iterationNumber));\n        task.Start();\n        tasks.Add(task);\n    }\n    await Task.WhenAll(tasks);\n}\n")),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"Implement method ",(0,r.kt)("inlineCode",{parentName:"li"},"Main")," in class ",(0,r.kt)("inlineCode",{parentName:"li"},"Program"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public static async Task Main()\n{\n    stopwatch.Restart();\n    await DoWorkAsynchronously();\n    stopwatch.Stop();\n    var asyncCodeDuration = stopwatch.Elapsed;\n            \n    stopwatch.Restart();\n    DoWorkSynchronously();\n    stopwatch.Stop();\n    var syncCodeDuration = stopwatch.Elapsed;\n\n    Console.WriteLine($"Asynchronous code duration {asyncCodeDuration}");\n    Console.WriteLine($"Synchronous code Duration {syncCodeDuration}");\n}\n')),(0,r.kt)("h3",{id:"run-project-2"},(0,r.kt)("strong",{parentName:"h3"},"Run Project")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Execute the project and the output similar to the following will appear:")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"async-await-output",src:n(4481).Z,width:"414",height:"837"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Increase value of ",(0,r.kt)("inlineCode",{parentName:"li"},"NumberOfIterations")," and observe changes to execution times!")))}c.isMDXComponent=!0},4481:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/async-await-output-89995857d9f40d27662622fe61c61ac9.jpg"},9513:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/creating-threads-output-460967a1680547b9d4dcbd60cae8c2d5.jpg"},3714:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/creating-threads-uml-9f027ae609bf9fce6c5af2b89f5466e7.png"},8288:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/managing-threads-output-ba5044cd644155fa9844fcc742062a31.jpg"},7431:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/managing-threads-uml-196212e98f7f4c7cd02e53ae5ac0d919.png"},3041:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/provokign-races-uml-00a7c2950eb713b4d5a19e0fc3fd8327.png"},9559:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/provoking-races-output-521c25631cb232fb5b510b5fc4bfac4e.jpg"},9975:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/responsive-gui-app-0c2a1950caa3645a0b1212ac4a47a306.jpg"},5960:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/thread-lifecycle-1ca20bc377a6a823bec8e0b21d68b097.png"},5170:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/using-tasks-output-d36d792d3e78a718d5b076a2b360d2ce.jpg"},4934:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/using-thread-pools-output-d98b3c17e7de2f5d21ae336ebb390379.jpg"}}]);